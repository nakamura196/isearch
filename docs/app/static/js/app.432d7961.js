(function(t){function e(e){for(var r,l,n=e[0],o=e[1],c=e[2],h=0,d=[];h<n.length;h++)l=n[h],Object.prototype.hasOwnProperty.call(s,l)&&s[l]&&d.push(s[l][0]),s[l]=0;for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(t[r]=o[r]);u&&u(e);while(d.length)d.shift()();return i.push.apply(i,c||[]),a()}function a(){for(var t,e=0;e<i.length;e++){for(var a=i[e],r=!0,n=1;n<a.length;n++){var o=a[n];0!==s[o]&&(r=!1)}r&&(i.splice(e--,1),t=l(l.s=a[0]))}return t}var r={},s={app:0},i=[];function l(e){if(r[e])return r[e].exports;var a=r[e]={i:e,l:!1,exports:{}};return t[e].call(a.exports,a,a.exports,l),a.l=!0,a.exports}l.m=t,l.c=r,l.d=function(t,e,a){l.o(t,e)||Object.defineProperty(t,e,{enumerable:!0,get:a})},l.r=function(t){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(t,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(t,"__esModule",{value:!0})},l.t=function(t,e){if(1&e&&(t=l(t)),8&e)return t;if(4&e&&"object"===typeof t&&t&&t.__esModule)return t;var a=Object.create(null);if(l.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:t}),2&e&&"string"!=typeof t)for(var r in t)l.d(a,r,function(e){return t[e]}.bind(null,r));return a},l.n=function(t){var e=t&&t.__esModule?function(){return t["default"]}:function(){return t};return l.d(e,"a",e),e},l.o=function(t,e){return Object.prototype.hasOwnProperty.call(t,e)},l.p="";var n=window["webpackJsonp"]=window["webpackJsonp"]||[],o=n.push.bind(n);n.push=e,n=n.slice();for(var c=0;c<n.length;c++)e(n[c]);var u=o;i.push([0,"chunk-vendors"]),a()})({0:function(t,e,a){t.exports=a("56d7")},"034f":function(t,e,a){"use strict";var r=a("1356"),s=a.n(r);s.a},1356:function(t,e,a){},"56d7":function(t,e,a){"use strict";a.r(e);var r=a("2b0e"),s=function(){var t=this,e=t.$createElement,a=t._self._c||e;return a("v-app",[a("v-app-bar",[a("v-toolbar-title",[t._v(t._s(t.config.header))])],1),a("v-content",[a("v-container",[a("v-card",{staticClass:"my-5"},[a("v-card-text",[a("v-text-field",{attrs:{label:"Full text search"},on:{keyup:function(e){return!e.type.indexOf("key")&&t._k(e.keyCode,"enter",13,e.key,"Enter")?null:t.search_move(e)}},model:{value:t.advanced_search["Full text search"],callback:function(e){t.$set(t.advanced_search,"Full text search",e)},expression:"advanced_search['Full text search']"}}),a("v-btn",{attrs:{color:"primary"},on:{click:t.search_move}},[t._v("Search")]),a("v-btn",{staticClass:"ml-4",on:{click:t.reset}},[t._v("Reset")])],1)],1)],1),a("div",{staticClass:"pb-5",staticStyle:{"background-color":"#eeeeee"}},[a("v-container",[a("v-row",[a("v-col",{attrs:{cols:"12",sm:"3"}},[a("h3",[t._v(t._s(((t.query.page-1)*t.query.size+1).toLocaleString())+" - "+t._s((t.query.page*t.query.size>t.total?t.total:t.query.page*t.query.size).toLocaleString())+" of "+t._s(t.total.toLocaleString())+" results")])]),a("v-col",{attrs:{cols:"12",sm:"9"}},[a("v-row",[a("v-col",[a("v-select",{attrs:{items:t.computed_items_sort,label:"Sort by"},on:{change:t.sort_move},model:{value:t.query.sort,callback:function(e){t.$set(t.query,"sort",e)},expression:"query.sort"}})],1),a("v-col",[a("v-select",{attrs:{items:[20,50,100],label:"Items per page"},on:{change:t.size_move},model:{value:t.query.size,callback:function(e){t.$set(t.query,"size",e)},expression:"query.size"}})],1),a("v-col",[a("span",{staticClass:"mr-2"},[t._v("Layout")]),a("v-btn-toggle",{attrs:{mandatory:""},model:{value:t.layout,callback:function(e){t.layout=e},expression:"layout"}},[a("v-btn",[a("i",{staticClass:"fas fa-th-large"})]),a("v-btn",[a("i",{staticClass:"fas fa-th-list"})])],1)],1)],1)],1)],1),a("v-card",{staticStyle:{"background-color":"#eeeeee"},attrs:{outlined:""}},[a("v-card-text",[a("span",{staticClass:"mr-2"},[t._v("Filtered by")]),t._l(t.advanced_search_display,(function(e,r){return a("span",{key:"a_"+r},[e!=[]&&""!=e?a("v-btn",{staticClass:"mx-1 my-1",attrs:{color:"primary",small:""},on:{click:function(e){t.advanced_search[r]="",t.search(!0)}}},[t._v("\n                [Advanced] "+t._s(r.replace(".keyword",""))+":\n                "),a("b",{staticClass:"mx-2",class:"Phone/Word"==r?"phone":""},[t._v(t._s(e instanceof Array?e.join(", "):e))]),a("span",{attrs:{"aria-hidden":"true"}},[t._v("×")])]):t._e()],1)})),t._l(t.facet_search,(function(e,r){return a("span",{key:"f_"+r},[e!=[]&&""!=e?a("v-btn",{staticClass:"mx-1 my-1",attrs:{color:"primary",small:""},on:{click:function(e){t.facet_search[r]="",t.search(!0)}}},[t._v("\n                [Facet] "+t._s(r.replace(".keyword",""))+":\n                "),a("b",{staticClass:"mx-2",class:"Phone/Word"==r?"phone":""},[t._v(t._s(e instanceof Array?e.join(", "):e))]),a("span",{attrs:{"aria-hidden":"true"}},[t._v("×")])]):t._e()],1)}))],2)],1)],1)],1),a("v-container",{staticClass:"mt-5"},[a("v-row",[a("v-col",{staticStyle:{"background-color":"#eeeeee"},attrs:{cols:"12",sm:"3"}},[t.total>0?[a("h3",{staticClass:"mb-5"},[t._v("Refine your search")]),t._l(t.results.aggregations,(function(e,r){return["Full text search"!=r&&e.buckets.length>0?a("v-card",{key:"agg_"+r,staticClass:"my-5",attrs:{outlined:""}},[a("v-list",{attrs:{subheader:"","two-line":"",flat:""}},[a("v-subheader",[t._v(t._s(r))]),a("div",{staticStyle:{"max-height":"400px","overflow-y":"auto"}},[a("v-list-item-group",{attrs:{multiple:""}},[t._l(e.buckets,(function(e,s){return[""!=e.key?a("v-list-item",{key:"bucket_"+s,scopedSlots:t._u([{key:"default",fn:function(s){s.active,s.toggle;return[a("v-list-item-action",[a("v-checkbox",{attrs:{color:"primary"},model:{value:e.value,callback:function(a){t.$set(e,"value",a)},expression:"bucket.value"}})],1),a("v-list-item-content",[a("v-list-item-title",{class:"Phone/Word"==r?"phone":""},[t._v(t._s(e.key))])],1),a("v-list-item-action",[a("v-btn",{attrs:{icon:""}},[t._v(t._s(e.doc_count))])],1)]}}],null,!0)}):t._e()]}))],2)],1),a("v-card-text",[a("v-btn",{attrs:{small:"",color:"primary"},on:{click:t.facet_filter}},[t._v("Search")])],1)],1)],1):t._e()]}))]:t._e()],2),a("v-col",{attrs:{cols:"12",sm:"9"}},[t.total>0?[a("div",{staticClass:"text-center"},[a("v-pagination",{attrs:{length:t.pagination_length,"total-visible":7},on:{input:function(e){return t.page_move()}},model:{value:t.query.page,callback:function(e){t.$set(t.query,"page",e)},expression:"query.page"}})],1),0==t.layout?[a("v-row",t._l(t.results.hits.hits,(function(e,r){return a("v-col",{key:"result_"+r,attrs:{cols:"6",sm:"3"}},[a("v-card",[a("a",{attrs:{target:"_blank",href:e._related[0]}},[a("v-img",{staticClass:"grey lighten-2",attrs:{src:e._thumbnail[0]}})],1),a("v-card-text",[a("a",{attrs:{href:e._related[0],target:"_blank"}},[a("b",[t._v(t._s(e.Title[0]))])])])],1)],1)})),1)]:t._l(t.results.hits.hits,(function(e,r){return a("v-card",{key:"result_"+r,staticClass:"my-5"},[a("v-card-text",[a("v-row",[a("v-col",{attrs:{cols:"12",sm:"3"}},[a("a",{attrs:{target:"_blank",href:e._related[0]}},[a("v-img",{staticClass:"grey lighten-2",attrs:{src:e._thumbnail[0]}})],1)]),a("v-col",{attrs:{cols:"12",sm:"9"}},[a("a",{attrs:{href:e._related[0],target:"_blank"}},[a("b",[t._v(t._s(e.Title[0]))])]),a("v-card-text",[t._l(e,(function(e,r){return[-1==r.indexOf("_")&&"Title"!=r?a("div",{key:r},[a("b",[t._v(t._s(r)+" :")]),t._v("\n                            "+t._s(e.join(", "))+"\n                          ")]):t._e()]}))],2)],1)],1)],1)],1)})),a("div",{staticClass:"text-center"},[a("v-pagination",{attrs:{length:t.pagination_length,"total-visible":7},on:{input:function(e){return t.page_move()}},model:{value:t.query.page,callback:function(e){t.$set(t.query,"page",e)},expression:"query.page"}})],1)]:t._e()],2)],1)],1)],1),a("v-footer",{staticClass:"mt-5",attrs:{dark:!0}},[a("v-container",[a("p",{staticClass:"text-center my-5"},[a("a",{staticStyle:{color:"white"},attrs:{href:"https://github.com/nakamura196/isearch"}},[t._v("https://github.com/nakamura196/isearch")])])])],1)],1)},i=[],l=a("bc3a"),n=a.n(l);let o=50;var c={data:()=>({config:{u:"",header:"",items_sort:{}},query:{query:{},aggs:{},size:50,from:0,page:1,sort:"Title Asc"},advanced_search:{},advanced_search_display:{},facet_search:{},index:{},data_all:[],data_filtered:[],results:[],facets:{},layout:0}),created(){let t=this.$route.query;console.log(t),t.u&&(this.config.u=t.u,n.a.get(t.u).then(e=>{let a=e.data;this.config.header=a.label;let r=[],s=a.manifests,i=1,l=this.index;for(let t=0;t<s.length;t++){let e=s[t],a={_thumbnail:[e.thumbnail],_related:[e.related],_id:[e["@id"]],Title:[e.label]};e.description&&(a.Description=[e.description]);let n=e.metadata;if(n)for(let t=0;t<n.length;t++){let e=n[t],r=e.value;r instanceof Array||(r=[r]),a[e.label]=r}let o="",c=i-1;for(let t in a){l[t]||(l[t]={});let e=a[t];for(let a=0;a<e.length;a++){let r=e[a];null==r||r.startsWith("http")||(l[t][r]||(l[t][r]=[]),l[t][r].push(c),o+=r+" ")}}let u="Full text search";l[u]||(l[u]={}),l[u][o]||(l[u][o]=[]),l[u][o].push(c),r.push(a),i+=1}this.index=l;let n=[],c={};for(let t in l)-1==t.indexOf("_")&&(c[t+" Asc"]={value:t,type:"asc"},c[t+" Desc"]={value:t,type:"desc"},this.facet_search[t]=[],n.push({label:t,field:t+".keyword"}));this.config.items_sort=c,this.data_all=r;let u={};for(let t=0;t<n.length;t++){let e=n[t];u[e.label]={terms:{field:e.field,order:{_count:"desc"},size:o}}}this.query.aggs=u,t.advanced&&(this.advanced_search=JSON.parse(t.advanced)),t.facet&&(this.facet_search=JSON.parse(t.facet)),t.layout&&(this.layout=Number(t.layout)),t.sort&&(this.query.sort=t.sort),t.size&&(this.query.size=Number(t.size)),this.search(!0)}))},methods:{search(t){if(window.scrollTo(0,0),t){let t=this.createQuery();this.query=t;let e=this.filter(this.query),a=this.getDataFiltered(e);this.data_filtered=a;let r=this.createFacets(e,this.query.aggs);this.facets=r}this.data_filtered=this.sort_data(this.data_filtered,this.query.sort);let e=this.getResult(this.data_filtered,(this.query.page-1)*this.query.size,this.query.size),a={aggregations:this.facets,hits:{hits:e,total:{relation:this.query.sort,value:this.data_filtered.length}}};for(let r in this.advanced_search)this.advanced_search_display[r]=this.advanced_search[r];this.update_param(),this.results=a},createQuery(){let t={},e=[],a=[];t.bool={filter:e,must:a};for(let s in this.advanced_search){let t=this.advanced_search[s];""!=t&&e.push(this.createMustQuery(s,[t],!1))}for(let s in this.facet_search){let t=this.facet_search[s];0!=t.length&&e.push(this.createFilterQuery(s,t))}let r=this.query;return r.query=t,r},createMustQuery(t,e,a){let r=[];for(let s=0;s<e.length;s++){let i=e[s];if(""==i)continue;let l={};a&&(t+=".keyword"),l[t]=i,r.push({match_phrase:l})}return{bool:{should:r}}},createFilterQuery(t,e){let a=[];for(let r=0;r<e.length;r++){let s=e[r];if(""==s)continue;let i={};i[t+".keyword"]=s,a.push({match_phrase:i})}return{bool:{should:a}}},getDataFiltered(t){let e=[];for(let a=0;a<t.length;a++)e.push(this.data_all[t[a]]);return e},sort_data(t,e){let a=this.config.items_sort[e],r=!0;"desc"==a.type&&(r=!1);let s=a.value,i=1,l=-1;r||(i*=-1,l*=-1);let n="Title";return t.sort((function(t,e){return t[s][0]>e[s][0]?i:t[s][0]<e[s][0]?l:t[n][0]>e[n][0]?i:t[n][0]<e[n][0]?l:0})),t},getResult(t,e,a){let r=[],s=e+a;s>this.data_filtered.length&&(s=this.data_filtered.length);for(let i=e;i<s;i++)r.push(this.data_filtered[i]);return r},createFacets(t,e){let a={};for(let r in e){let s=e[r].terms,i=Number(s.size),l=s.field.replace(".keyword",""),n=this.index[l],o={};for(let e in n){let a=new Set([...new Set(t)].filter(t=>new Set(n[e]).has(t))),r=a.size;r>0&&(o[e]=r)}let c=Object.keys(o).map(t=>({key:t,value:o[t]}));c.sort((function(t,e){return t.value<e.value?1:t.value>e.value?-1:0})),i>c.length&&(i=c.length);let u=[];for(let t=0;t<i;t++){let e=c[t].key,a={key:e,doc_count:c[t].value};this.facet_search[l]||(this.facet_search[l]=[]),-1!=this.facet_search[l].indexOf(e)&&(a.value=!0),u.push(a)}a[r]={buckets:u}}return a},filter(t){let e=this.index,a=[];for(let n=0;n<this.data_all.length;n++)a.push(n);let r=t.query.bool,s=new Set(a);for(let n in r){let t=r[n];for(let a=0;a<t.length;a++){let r=t[a].bool.should,i=new Set([]);for(let t=0;t<r.length;t++){let a=r[t]["match_phrase"];for(let t in a){let r=a[t],s=[];if(-1==t.indexOf(".keyword")){let a=e[t];for(let t in a)-1!=t.toLowerCase().indexOf(r.toLowerCase())&&(s=s.concat(a[t]))}else{t=t.replace(".keyword","");let a=e[t];for(let t in a)t.toLowerCase()==r.toLowerCase()&&(s=s.concat(a[t]))}let l=new Set(s);i=new Set([...i,...l])}}s=new Set([...s].filter(t=>i.has(t)))}}let i=[];for(var l of s)i.push(l);return i},page_move(){this.search()},sort_move(){this.search()},size_move(){this.search(!0)},search_move(){for(let t in this.facet_search){let e=this.facet_search[t];e=e instanceof Array?[]:"",this.facet_search[t]=e}1!=this.query.page&&(this.query.page=1,this.sort="Title Asc"),this.search(!0)},update_param(){let t={u:this.config.u,advanced:JSON.stringify(this.advanced_search),facet:JSON.stringify(this.facet_search),layout:this.layout,size:this.query.size,sort:this.query.sort};this.$router.replace({query:t},()=>{},()=>{})},init_param(){this.query.query={},this.query.size=50,this.query.from=0,this.query.page=1,this.query.sort="Title Asc";for(let t in this.advanced_search){let e=this.advanced_search[t];e=e instanceof Array?[]:"",this.advanced_search[t]=e}for(let t in this.facet_search){let e=this.facet_search[t];e=e instanceof Array?[]:"",this.facet_search[t]=e}this.update_param()},reset(){this.init_param(),this.search(!0)},facet_search_move(t,e,a){this.init_param(),this[t][e]=a,this.search(!0)},facet_filter(){for(let e in this.facet_search){let t=this.facet_search[e];t=t instanceof Array?[]:"",this.facet_search[e]=t}let t=this.results.aggregations;for(let e in t){let a=t[e].buckets;for(let t=0;t<a.length;t++){let r=a[t];r.value&&(this.facet_search[e]||(this.facet_search[e]=[]),this.facet_search[e].push(r.key))}}this.search(!0)}},watch:{layout:function(){this.update_param()}},computed:{total:function(){let t=0;return this.results.hits&&(t=this.results.hits.total.value),t},pagination_length:function(){return Math.ceil(this.total/this.query.size)},computed_items_sort:function(){let t=[];for(let e in this.config.items_sort)t.push(e);return t}}},u=c,h=(a("034f"),a("2877")),d=a("6544"),f=a.n(d),_=a("7496"),v=a("40dc"),p=a("8336"),y=a("a609"),g=a("b0af"),m=a("99d9"),b=a("ac7c"),k=a("62ad"),x=a("a523"),q=a("a75b"),w=a("553a"),C=a("adda"),S=a("8860"),V=a("da13"),O=a("1800"),z=a("5d23"),T=a("1baa"),F=a("891e"),A=a("0fd9"),j=a("b974"),L=a("e0c7"),P=a("8654"),$=a("2a7f"),I=Object(h["a"])(u,s,i,!1,null,null,null),M=I.exports;f()(I,{VApp:_["a"],VAppBar:v["a"],VBtn:p["a"],VBtnToggle:y["a"],VCard:g["a"],VCardText:m["a"],VCheckbox:b["a"],VCol:k["a"],VContainer:x["a"],VContent:q["a"],VFooter:w["a"],VImg:C["a"],VList:S["a"],VListItem:V["a"],VListItemAction:O["a"],VListItemContent:z["a"],VListItemGroup:T["a"],VListItemTitle:z["b"],VPagination:F["a"],VRow:A["a"],VSelect:j["a"],VSubheader:L["a"],VTextField:P["a"],VToolbarTitle:$["a"]});var N=a("8c4f");r["a"].use(N["a"]);var J=new N["a"]({routes:[]}),Q=a("f309");r["a"].use(Q["a"]);var R=new Q["a"]({icons:{iconfont:"mdi"}});r["a"].config.productionTip=!1,new r["a"]({router:J,vuetify:R,render:t=>t(M)}).$mount("#app")}});
//# sourceMappingURL=app.432d7961.js.map