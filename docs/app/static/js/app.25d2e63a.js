(function(e){function t(t){for(var r,l,n=t[0],o=t[1],c=t[2],h=0,d=[];h<n.length;h++)l=n[h],Object.prototype.hasOwnProperty.call(s,l)&&s[l]&&d.push(s[l][0]),s[l]=0;for(r in o)Object.prototype.hasOwnProperty.call(o,r)&&(e[r]=o[r]);u&&u(t);while(d.length)d.shift()();return i.push.apply(i,c||[]),a()}function a(){for(var e,t=0;t<i.length;t++){for(var a=i[t],r=!0,n=1;n<a.length;n++){var o=a[n];0!==s[o]&&(r=!1)}r&&(i.splice(t--,1),e=l(l.s=a[0]))}return e}var r={},s={app:0},i=[];function l(t){if(r[t])return r[t].exports;var a=r[t]={i:t,l:!1,exports:{}};return e[t].call(a.exports,a,a.exports,l),a.l=!0,a.exports}l.m=e,l.c=r,l.d=function(e,t,a){l.o(e,t)||Object.defineProperty(e,t,{enumerable:!0,get:a})},l.r=function(e){"undefined"!==typeof Symbol&&Symbol.toStringTag&&Object.defineProperty(e,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(e,"__esModule",{value:!0})},l.t=function(e,t){if(1&t&&(e=l(e)),8&t)return e;if(4&t&&"object"===typeof e&&e&&e.__esModule)return e;var a=Object.create(null);if(l.r(a),Object.defineProperty(a,"default",{enumerable:!0,value:e}),2&t&&"string"!=typeof e)for(var r in e)l.d(a,r,function(t){return e[t]}.bind(null,r));return a},l.n=function(e){var t=e&&e.__esModule?function(){return e["default"]}:function(){return e};return l.d(t,"a",t),t},l.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},l.p="";var n=window["webpackJsonp"]=window["webpackJsonp"]||[],o=n.push.bind(n);n.push=t,n=n.slice();for(var c=0;c<n.length;c++)t(n[c]);var u=o;i.push([0,"chunk-vendors"]),a()})({0:function(e,t,a){e.exports=a("56d7")},"034f":function(e,t,a){"use strict";var r=a("1356"),s=a.n(r);s.a},1356:function(e,t,a){},"56d7":function(e,t,a){"use strict";a.r(t);var r=a("2b0e"),s=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("v-app",[a("v-app-bar",[a("v-toolbar-title",[e._v(e._s(e.config.header))])],1),a("v-content",[a("v-container",[a("v-card",{staticClass:"my-5"},[a("v-card-text",[a("v-text-field",{attrs:{label:"Full text search"},on:{keyup:function(t){return!t.type.indexOf("key")&&e._k(t.keyCode,"enter",13,t.key,"Enter")?null:e.search_move(t)}},model:{value:e.advanced_search["Full text search"],callback:function(t){e.$set(e.advanced_search,"Full text search",t)},expression:"advanced_search['Full text search']"}}),a("v-btn",{attrs:{color:"primary"},on:{click:e.search_move}},[e._v("Search")]),a("v-btn",{staticClass:"ml-4",on:{click:e.reset}},[e._v("Reset")])],1)],1)],1),a("div",{staticClass:"pb-5",staticStyle:{"background-color":"#eeeeee"}},[a("v-container",[a("v-row",[a("v-col",{attrs:{cols:"12",sm:"3"}},[a("h3",[e._v(e._s(((e.query.page-1)*e.query.size+1).toLocaleString())+" - "+e._s((e.query.page*e.query.size>e.total?e.total:e.query.page*e.query.size).toLocaleString())+" of "+e._s(e.total.toLocaleString())+" results")])]),a("v-col",{attrs:{cols:"12",sm:"9"}},[a("v-row",[a("v-col",[a("v-select",{attrs:{items:e.computed_items_sort,label:"Sort by"},on:{change:e.sort_move},model:{value:e.query.sort,callback:function(t){e.$set(e.query,"sort",t)},expression:"query.sort"}})],1),a("v-col",[a("v-select",{attrs:{items:[20,50,100],label:"Items per page"},on:{change:e.size_move},model:{value:e.query.size,callback:function(t){e.$set(e.query,"size",t)},expression:"query.size"}})],1),a("v-col",[a("v-select",{attrs:{items:["List","Grid"],label:"Layout"},model:{value:e.layout,callback:function(t){e.layout=t},expression:"layout"}})],1)],1)],1)],1),a("v-card",{staticStyle:{"background-color":"#eeeeee"},attrs:{outlined:""}},[a("v-card-text",[a("span",{staticClass:"mr-2"},[e._v("Filtered by")]),e._l(e.advanced_search_display,(function(t,r){return a("span",{key:"a_"+r},[t!=[]&&""!=t?a("v-btn",{staticClass:"mx-1 my-1",attrs:{color:"primary",small:""},on:{click:function(t){e.advanced_search[r]="",e.search(!0)}}},[e._v("\n                [Advanced] "+e._s(r.replace(".keyword",""))+":\n                "),a("b",{staticClass:"mx-2",class:"Phone/Word"==r?"phone":""},[e._v(e._s(t instanceof Array?t.join(", "):t))]),a("span",{attrs:{"aria-hidden":"true"}},[e._v("×")])]):e._e()],1)})),e._l(e.facet_search,(function(t,r){return a("span",{key:"f_"+r},[t!=[]&&""!=t?a("v-btn",{staticClass:"mx-1 my-1",attrs:{color:"primary",small:""},on:{click:function(t){e.facet_search[r]="",e.search(!0)}}},[e._v("\n                [Facet] "+e._s(r.replace(".keyword",""))+":\n                "),a("b",{staticClass:"mx-2",class:"Phone/Word"==r?"phone":""},[e._v(e._s(t instanceof Array?t.join(", "):t))]),a("span",{attrs:{"aria-hidden":"true"}},[e._v("×")])]):e._e()],1)}))],2)],1)],1)],1),a("v-container",{staticClass:"mt-5"},[a("v-row",[a("v-col",{staticStyle:{"background-color":"#eeeeee"},attrs:{cols:"12",sm:"3"}},[e.total>0?[a("h3",{staticClass:"mb-5"},[e._v("Refine your search")]),e._l(e.results.aggregations,(function(t,r){return["Full text search"!=r&&t.buckets.length>0?a("v-card",{key:"agg_"+r,staticClass:"my-5",attrs:{outlined:""}},[a("v-list",{attrs:{subheader:"","two-line":"",flat:""}},[a("v-subheader",[e._v(e._s(r))]),a("div",{staticStyle:{"max-height":"400px","overflow-y":"auto"}},[a("v-list-item-group",{attrs:{multiple:""}},[e._l(t.buckets,(function(t,s){return[""!=t.key?a("v-list-item",{key:"bucket_"+s,scopedSlots:e._u([{key:"default",fn:function(s){s.active,s.toggle;return[a("v-list-item-action",[a("v-checkbox",{attrs:{color:"primary"},model:{value:t.value,callback:function(a){e.$set(t,"value",a)},expression:"bucket.value"}})],1),a("v-list-item-content",[a("v-list-item-title",{class:"Phone/Word"==r?"phone":""},[e._v(e._s(t.key))])],1),a("v-list-item-action",[a("v-btn",{attrs:{icon:""}},[e._v(e._s(t.doc_count))])],1)]}}],null,!0)}):e._e()]}))],2)],1),a("v-card-text",[a("v-btn",{attrs:{small:"",color:"primary"},on:{click:e.facet_filter}},[e._v("Search")])],1)],1)],1):e._e()]}))]:e._e()],2),a("v-col",{attrs:{cols:"12",sm:"9"}},[e.total>0?[a("div",{staticClass:"text-center"},[a("v-pagination",{attrs:{length:e.pagination_length,"total-visible":7},on:{input:function(t){return e.page_move()}},model:{value:e.query.page,callback:function(t){e.$set(e.query,"page",t)},expression:"query.page"}})],1),"Grid"==e.layout?[a("v-row",e._l(e.results.hits.hits,(function(t,r){return a("v-col",{key:"result_"+r,attrs:{cols:"6",sm:"3"}},[a("v-card",[a("a",{attrs:{target:"_blank",href:t._related[0]}},[a("v-img",{staticClass:"grey lighten-2",attrs:{src:t._thumbnail[0]}})],1),a("v-card-text",[a("a",{attrs:{href:t._related[0],target:"_blank"}},[a("b",[e._v(e._s(t.Title[0]))])])])],1)],1)})),1)]:e._l(e.results.hits.hits,(function(t,r){return a("v-card",{key:"result_"+r,staticClass:"my-5"},[a("v-card-text",[a("v-row",[a("v-col",{attrs:{cols:"12",sm:"4"}},[a("a",{attrs:{target:"_blank",href:t._related[0]}},[a("v-img",{staticClass:"grey lighten-2",attrs:{src:t._thumbnail[0]}})],1)]),a("v-col",{attrs:{cols:"12",sm:"8"}},[a("a",{attrs:{href:t._related[0],target:"_blank"}},[a("b",[e._v(e._s(t.Title[0]))])]),a("v-card-text",[e._l(t,(function(t,r){return[-1==r.indexOf("_")&&"Title"!=r?a("div",{key:r},[a("b",[e._v(e._s(r)+" :")]),e._v("\n                            "+e._s(t.join(", "))+"\n                          ")]):e._e()]}))],2)],1)],1)],1)],1)})),a("div",{staticClass:"text-center"},[a("v-pagination",{attrs:{length:e.pagination_length,"total-visible":7},on:{input:function(t){return e.page_move()}},model:{value:e.query.page,callback:function(t){e.$set(e.query,"page",t)},expression:"query.page"}})],1)]:e._e()],2)],1)],1)],1),a("v-footer",{staticClass:"mt-5",attrs:{dark:!0}},[a("v-container",[a("p",{staticClass:"text-center my-5"},[a("a",{staticStyle:{color:"white"},attrs:{href:"https://github.com/nakamura196/isearch"}},[e._v("https://github.com/nakamura196/isearch")])])])],1)],1)},i=[],l=a("bc3a"),n=a.n(l);let o=50;var c={data:()=>({config:{u:"",header:"",items_sort:{}},query:{query:{},aggs:{},size:20,from:0,page:1,sort:"Title Asc"},advanced_search:{},advanced_search_display:{},facet_search:{},index:{},data_all:[],data_filtered:[],results:[],facets:{},layout:"List"}),created(){let e=this.$route.query;console.log(e),e.u&&(this.config.u=e.u,n.a.get(e.u).then(t=>{let a=t.data;this.config.header=a.label;let r=[],s=a.manifests,i=1,l=this.index;for(let e=0;e<s.length;e++){let t=s[e],a={_thumbnail:[t.thumbnail],_related:[t.related],_id:[t["@id"]],Title:[t.label]};t.description&&(a.Description=[t.description]);let n=t.metadata;if(n)for(let e=0;e<n.length;e++){let t=n[e],r=t.value;r instanceof Array||(r=[r]),a[t.label]=r}let o="",c=i-1;for(let e in a){l[e]||(l[e]={});let t=a[e];for(let a=0;a<t.length;a++){let r=t[a];null==r||r.startsWith("http")||(l[e][r]||(l[e][r]=[]),l[e][r].push(c),o+=r+" ")}}let u="Full text search";l[u]||(l[u]={}),l[u][o]||(l[u][o]=[]),l[u][o].push(c),r.push(a),i+=1}this.index=l;let n=[],c={};for(let e in l)-1==e.indexOf("_")&&(c[e+" Asc"]={value:e,type:"asc"},c[e+" Desc"]={value:e,type:"desc"},this.facet_search[e]=[],n.push({label:e,field:e+".keyword"}));this.config.items_sort=c,this.data_all=r;let u={};for(let e=0;e<n.length;e++){let t=n[e];u[t.label]={terms:{field:t.field,order:{_count:"desc"},size:o}}}this.query.aggs=u,e.advanced&&(this.advanced_search=JSON.parse(e.advanced)),e.facet&&(this.facet_search=JSON.parse(e.facet)),e.layout&&(this.layout=e.layout),e.sort&&(this.query.sort=e.sort),e.size&&(this.query.size=Number(e.size)),this.search(!0)}))},methods:{search(e){if(window.scrollTo(0,0),e){let e=this.createQuery();this.query=e;let t=this.filter(this.query),a=this.getDataFiltered(t);this.data_filtered=a;let r=this.createFacets(t,this.query.aggs);this.facets=r}this.data_filtered=this.sort_data(this.data_filtered,this.query.sort);let t=this.getResult(this.data_filtered,(this.query.page-1)*this.query.size,this.query.size),a={aggregations:this.facets,hits:{hits:t,total:{relation:this.query.sort,value:this.data_filtered.length}}};for(let r in this.advanced_search)this.advanced_search_display[r]=this.advanced_search[r];this.update_param(),this.results=a},createQuery(){let e={},t=[],a=[];e.bool={filter:t,must:a};for(let s in this.advanced_search){let e=this.advanced_search[s];""!=e&&t.push(this.createMustQuery(s,[e],!1))}for(let s in this.facet_search){let e=this.facet_search[s];0!=e.length&&t.push(this.createFilterQuery(s,e))}let r=this.query;return r.query=e,r},createMustQuery(e,t,a){let r=[];for(let s=0;s<t.length;s++){let i=t[s];if(""==i)continue;let l={};a&&(e+=".keyword"),l[e]=i,r.push({match_phrase:l})}return{bool:{should:r}}},createFilterQuery(e,t){let a=[];for(let r=0;r<t.length;r++){let s=t[r];if(""==s)continue;let i={};i[e+".keyword"]=s,a.push({match_phrase:i})}return{bool:{should:a}}},getDataFiltered(e){let t=[];for(let a=0;a<e.length;a++)t.push(this.data_all[e[a]]);return t},sort_data(e,t){let a=this.config.items_sort[t],r=!0;"desc"==a.type&&(r=!1);let s=a.value,i=1,l=-1;r||(i*=-1,l*=-1);let n="Title";return e.sort((function(e,t){return e[s][0]>t[s][0]?i:e[s][0]<t[s][0]?l:e[n][0]>t[n][0]?i:e[n][0]<t[n][0]?l:0})),e},getResult(e,t,a){let r=[],s=t+a;s>this.data_filtered.length&&(s=this.data_filtered.length);for(let i=t;i<s;i++)r.push(this.data_filtered[i]);return r},createFacets(e,t){let a={};for(let r in t){let s=t[r].terms,i=Number(s.size),l=s.field.replace(".keyword",""),n=this.index[l],o={};for(let t in n){let a=new Set([...new Set(e)].filter(e=>new Set(n[t]).has(e))),r=a.size;r>0&&(o[t]=r)}let c=Object.keys(o).map(e=>({key:e,value:o[e]}));c.sort((function(e,t){return e.value<t.value?1:e.value>t.value?-1:0})),i>c.length&&(i=c.length);let u=[];for(let e=0;e<i;e++){let t=c[e].key,a={key:t,doc_count:c[e].value};this.facet_search[l]||(this.facet_search[l]=[]),-1!=this.facet_search[l].indexOf(t)&&(a.value=!0),u.push(a)}a[r]={buckets:u}}return a},filter(e){let t=this.index,a=[];for(let n=0;n<this.data_all.length;n++)a.push(n);let r=e.query.bool,s=new Set(a);for(let n in r){let e=r[n];for(let a=0;a<e.length;a++){let r=e[a].bool.should,i=new Set([]);for(let e=0;e<r.length;e++){let a=r[e]["match_phrase"];for(let e in a){let r=a[e],s=[];if(-1==e.indexOf(".keyword")){let a=t[e];for(let e in a)-1!=e.toLowerCase().indexOf(r.toLowerCase())&&(s=s.concat(a[e]))}else{e=e.replace(".keyword","");let a=t[e];for(let e in a)e.toLowerCase()==r.toLowerCase()&&(s=s.concat(a[e]))}let l=new Set(s);i=new Set([...i,...l])}}s=new Set([...s].filter(e=>i.has(e)))}}let i=[];for(var l of s)i.push(l);return i},page_move(){this.search()},sort_move(){this.search()},size_move(){this.search(!0)},search_move(){for(let e in this.facet_search){let t=this.facet_search[e];t=t instanceof Array?[]:"",this.facet_search[e]=t}1!=this.query.page&&(this.query.page=1,this.sort="Title Asc"),this.search(!0)},update_param(){let e={u:this.config.u,advanced:JSON.stringify(this.advanced_search),facet:JSON.stringify(this.facet_search),layout:this.layout,size:this.query.size,sort:this.query.sort};this.$router.replace({query:e},()=>{},()=>{})},init_param(){this.query.query={},this.query.size=20,this.query.from=0,this.query.page=1,this.query.sort="Title Asc";for(let e in this.advanced_search){let t=this.advanced_search[e];t=t instanceof Array?[]:"",this.advanced_search[e]=t}for(let e in this.facet_search){let t=this.facet_search[e];t=t instanceof Array?[]:"",this.facet_search[e]=t}this.update_param()},reset(){this.init_param(),this.search(!0)},facet_search_move(e,t,a){this.init_param(),this[e][t]=a,this.search(!0)},facet_filter(){for(let t in this.facet_search){let e=this.facet_search[t];e=e instanceof Array?[]:"",this.facet_search[t]=e}let e=this.results.aggregations;for(let t in e){let a=e[t].buckets;for(let e=0;e<a.length;e++){let r=a[e];r.value&&(this.facet_search[t]||(this.facet_search[t]=[]),this.facet_search[t].push(r.key))}}this.search(!0)}},watch:{layout:function(){this.update_param()}},computed:{total:function(){let e=0;return this.results.hits&&(e=this.results.hits.total.value),e},pagination_length:function(){return Math.ceil(this.total/this.query.size)},computed_items_sort:function(){let e=[];for(let t in this.config.items_sort)e.push(t);return e}}},u=c,h=(a("034f"),a("2877")),d=a("6544"),f=a.n(d),_=a("7496"),v=a("40dc"),p=a("8336"),y=a("b0af"),g=a("99d9"),m=a("ac7c"),b=a("62ad"),k=a("a523"),x=a("a75b"),q=a("553a"),w=a("adda"),S=a("8860"),C=a("da13"),O=a("1800"),V=a("5d23"),z=a("1baa"),T=a("891e"),F=a("0fd9"),L=a("b974"),A=a("e0c7"),j=a("8654"),P=a("2a7f"),$=Object(h["a"])(u,s,i,!1,null,null,null),I=$.exports;f()($,{VApp:_["a"],VAppBar:v["a"],VBtn:p["a"],VCard:y["a"],VCardText:g["a"],VCheckbox:m["a"],VCol:b["a"],VContainer:k["a"],VContent:x["a"],VFooter:q["a"],VImg:w["a"],VList:S["a"],VListItem:C["a"],VListItemAction:O["a"],VListItemContent:V["a"],VListItemGroup:z["a"],VListItemTitle:V["b"],VPagination:T["a"],VRow:F["a"],VSelect:L["a"],VSubheader:A["a"],VTextField:j["a"],VToolbarTitle:P["a"]});var M=a("8c4f");r["a"].use(M["a"]);var J=new M["a"]({routes:[]}),N=a("f309");r["a"].use(N["a"]);var Q=new N["a"]({icons:{iconfont:"mdi"}});r["a"].config.productionTip=!1,new r["a"]({router:J,vuetify:Q,render:e=>e(I)}).$mount("#app")}});
//# sourceMappingURL=app.25d2e63a.js.map